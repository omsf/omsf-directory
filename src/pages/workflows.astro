---
import { getCollection } from 'astro:content'
import TagFilter from '../components/TagFilter.svelte'
import BaseLayout from '../layouts/BaseLayout.astro'
import { type SoftwareSchema, compareFunc, getAllTags } from '../schemas'

const workflows = await getCollection('workflows')
const openffWorkflows = await getCollection('openffWorkflows')
const openfeWorkflows = await getCollection('openfeWorkflows')
const modifiedOpenFFWorkflows = openffWorkflows.map((workflow) => ({
	...(workflow.data as SoftwareSchema),
	project: 'Open Force Field'
}))
const modifiedOpenFEWorkflows = openfeWorkflows.map((workflow) => ({
	...(workflow.data as SoftwareSchema),
	project: 'Open Free Energy'
}))
const filteredWorkflows: SoftwareSchema[] = workflows
	.map((workflow) => workflow.data)
	.concat(modifiedOpenFFWorkflows)
	.concat(modifiedOpenFEWorkflows)
	.sort(compareFunc)
const allTags = getAllTags(filteredWorkflows)
---

<BaseLayout currentPage="workflows">
  <TagFilter client:load items={filteredWorkflows} allTags={allTags} />
</BaseLayout>
